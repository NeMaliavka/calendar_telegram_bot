# Calendar Bot - Telegram бот для записи на пробное занятие

Telegram бот на aiogram с интеграцией Google Calendar для автоматического определения свободного времени и записи на пробное занятие.

## Возможности

- ✅ Просмотр свободного времени на сегодня (`/free`)
- ✅ Просмотр свободного времени на неделю (`/freeweek`)
- ✅ Интерактивная запись через кнопки (`/book`)
- ✅ Автоматическое создание событий в Google Calendar
- ✅ Уведомления администраторов о новых бронированиях
- ✅ Проверка доступности слотов перед бронированием

## Установка

### 1. Установите зависимости

```bash
pip install -r requirements.txt
```

### 2. Настройте .env файл

Убедитесь, что в `.env` файле указаны:

```env
TELEGRAM_BOT_TOKEN=ваш_токен_бота
GOOGLE_CALENDAR_ACTIVATE=True
GOOGLE_CREDENTIALS_PATH=./google-credentials.json
GOOGLE_CALENDAR_ID=ваш_email@gmail.com
```

### 3. Подготовьте Google Calendar

1. Создайте Service Account в Google Cloud Console
2. Скачайте JSON-ключ и сохраните как `google-credentials.json` (или укажите другой путь в `.env`)
3. Поделитесь календарем с email из Service Account (дайте права "Make changes to events")

### 4. Запустите бота

```bash
python backend/bot.py
```

## Структура проекта

```
backend/
├── bot.py              # Основной файл Telegram бота
├── calendar_service.py # Работа с Google Calendar API
├── booking_service.py  # Логика бронирования
├── config.py          # Конфигурация из .env
└── utils.py           # Утилиты для форматирования
```

## Команды бота

- `/start` - Приветствие и список команд
- `/help` - Справка по командам
- `/free` - Свободное время на сегодня (с кнопками)
- `/freeweek` - Свободное время на неделю (с кнопками)
- `/book` - Записаться на занятие (интерактивно)

## Как это работает

1. Пользователь отправляет `/book`
2. Бот получает свободные слоты из Google Calendar
3. Создается клавиатура с кнопками, на каждой показано дата и время (например: "Сегодня 10:00-11:00")
4. Пользователь выбирает кнопку с нужным временем
5. Появляется подтверждение с деталями
6. После подтверждения создается событие в календаре
7. Администраторы получают уведомление о новом бронировании

## Настройки

В `.env` файле можно настроить:

- `START_HOUR` - Начало рабочего дня (по умолчанию 9)
- `END_HOUR` - Конец рабочего дня (по умолчанию 18)
- `SLOT_DURATION` - Длительность слота в минутах (по умолчанию 60)
- `TIMEZONE` - Часовой пояс (по умолчанию Europe/Moscow)
- `ADMIN_IDS` - ID администраторов для уведомлений (через запятую)

## Логирование

Бот логирует все действия. Уровень логирования настраивается через `LOG_LEVEL` в `.env`:
- `DEBUG` - Подробные логи
- `INFO` - Информационные сообщения (по умолчанию)
- `WARNING` - Только предупреждения
- `ERROR` - Только ошибки

## Устранение неполадок

### Бот не запускается

- Проверьте, что `TELEGRAM_BOT_TOKEN` указан в `.env`
- Убедитесь, что токен бота правильный (получите у @BotFather)

### Ошибка доступа к календарю

- Проверьте, что `GOOGLE_CALENDAR_ACTIVATE=True`
- Убедитесь, что файл credentials существует и путь указан правильно
- Проверьте, что календарь расшарен с email из Service Account

### Слоты не отображаются

- Проверьте рабочие часы (`START_HOUR`, `END_HOUR`)
- Убедитесь, что в календаре есть свободное время
- Проверьте часовой пояс (`TIMEZONE`)

